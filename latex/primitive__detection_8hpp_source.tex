\hypertarget{primitive__detection_8hpp_source}{}\doxysection{primitive\+\_\+detection.\+hpp}
\label{primitive__detection_8hpp_source}\index{/home/baptou/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/features/primitives/primitive\_detection.hpp@{/home/baptou/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/features/primitives/primitive\_detection.hpp}}
\mbox{\hyperlink{primitive__detection_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef RGBDSLAM\_FEATURES\_PRIMITIVES\_PRIMITIVEDETECTION\_HPP }}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define RGBDSLAM\_FEATURES\_PRIMITIVES\_PRIMITIVEDETECTION\_HPP}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <opencv2/opencv.hpp>}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{plane__segment_8hpp}{plane\_segment.hpp}}"{}}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{cylinder__segment_8hpp}{cylinder\_segment.hpp}}"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{histogram_8hpp}{histogram.hpp}}"{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{shape__primitives_8hpp}{shape\_primitives.hpp}}"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{types_8hpp}{types.hpp}}"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacergbd__slam}{rgbd\_slam}} \{}
\DoxyCodeLine{18 \textcolor{keyword}{namespace }features \{}
\DoxyCodeLine{19 \textcolor{keyword}{namespace }primitives \{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21     \textcolor{keyword}{typedef} std::list<primitive\_uniq\_ptr> \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1primitives_a82fffe54c97a2ecd30ab76c0b1b1d910}{primitive\_container}}; }
\DoxyCodeLine{22 }
\DoxyCodeLine{26     \textcolor{keyword}{class }\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection}{Primitive\_Detection}} \{}
\DoxyCodeLine{27         \textcolor{comment}{//check for planes in an organized depth points matrix }}
\DoxyCodeLine{28         \textcolor{keyword}{protected}:}
\DoxyCodeLine{29             \textcolor{comment}{//typdefs}}
\DoxyCodeLine{30             \textcolor{keyword}{typedef} std::vector<std::pair<int, int>> \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ad96ff3c75c6a7784c3a8f1f4b0102a65}{intpair\_vector}};}
\DoxyCodeLine{31             \textcolor{keyword}{typedef} std::unique\_ptr<Plane\_Segment> \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a65c1f8eea51000c775c6e2c024df7d8b}{plane\_segment\_unique\_ptr}};}
\DoxyCodeLine{32             \textcolor{keyword}{typedef} std::unique\_ptr<Cylinder\_Segment> \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a5447caf12f82fefd49fa3a4b2e5d6eaf}{cylinder\_segment\_unique\_ptr}};}
\DoxyCodeLine{33             \textcolor{keyword}{typedef} std::vector<plane\_segment\_unique\_ptr> \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a1c6de1dae1c5b4783520c1720ad1bd7b}{planes\_ptr\_vector}}; }
\DoxyCodeLine{34             \textcolor{keyword}{typedef} std::vector<cylinder\_segment\_unique\_ptr> \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ae175d07a6ac399887ee4cd473b76fa41}{cylinders\_ptr\_vector}}; }
\DoxyCodeLine{35             \textcolor{keyword}{typedef} std::vector<uint> \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ab3ed9416eca995f1a3dc2fc2795bb2db}{uint\_vector}};}
\DoxyCodeLine{36 }
\DoxyCodeLine{37         \textcolor{keyword}{public}:}
\DoxyCodeLine{38 }
\DoxyCodeLine{47             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a096293d1058519af4111f1841496cccf}{Primitive\_Detection}}(\textcolor{keyword}{const} uint width, \textcolor{keyword}{const} uint height, \textcolor{keyword}{const} uint blocSize = 20, \textcolor{keyword}{const} \textcolor{keywordtype}{float} minCosAngleForMerge = 0.9659, \textcolor{keyword}{const} \textcolor{keywordtype}{float} maxMergeDistance = 50, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} useCylinderDetection = \textcolor{keyword}{false});}
\DoxyCodeLine{48 }
\DoxyCodeLine{56             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a911fc1929bc8ad43697ff1fecdd03570}{find\_primitives}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthMatrix, \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1primitives_a82fffe54c97a2ecd30ab76c0b1b1d910}{primitive\_container}}\& primitiveSegments, cv::Mat\& segOut);  \textcolor{comment}{//detect 3D primitives in depth image}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58 }
\DoxyCodeLine{59 }
\DoxyCodeLine{71             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a7f1ecaecbf481e926300056272eef75e}{apply\_masks}}(\textcolor{keyword}{const} cv::Mat\& inputImage, \textcolor{keyword}{const} std::vector<cv::Vec3b>\& colors, \textcolor{keyword}{const} cv::Mat\& maskImage, \textcolor{keyword}{const} \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1primitives_a82fffe54c97a2ecd30ab76c0b1b1d910}{primitive\_container}}\& primitiveSegments, cv::Mat\& labeledImage, \textcolor{keyword}{const} std::unordered\_map<int, uint>\& associatedIds, \textcolor{keyword}{const} \textcolor{keywordtype}{double} elapsedTime=0);}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 }
\DoxyCodeLine{74             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a9f64424ca0ce70414c2df2022c32dc7f}{\string~Primitive\_Detection}}();}
\DoxyCodeLine{75 }
\DoxyCodeLine{76             \textcolor{comment}{//perf measurments}}
\DoxyCodeLine{77             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a1e6576f91cd41de4316f20c41cbf365a}{resetTime}};}
\DoxyCodeLine{78             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a8e4334b78d47adf54a76b32812c18080}{initTime}};}
\DoxyCodeLine{79             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a8bd7311ff1c1968b338c80fa710b5f18}{growTime}};}
\DoxyCodeLine{80             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_afa8239c91447b7a5b6f2590a7024e5b1}{mergeTime}};}
\DoxyCodeLine{81             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_acee4e990aaeeec273775cf0fc944fa61}{refineTime}};}
\DoxyCodeLine{82             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a15e86c6c982aafda2c86c80e255cff98}{setMaskTime}};}
\DoxyCodeLine{83 }
\DoxyCodeLine{84         \textcolor{keyword}{protected}:}
\DoxyCodeLine{85 }
\DoxyCodeLine{89             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a115d7b6c99fa776c20350d6c5be88524}{reset\_data}}();}
\DoxyCodeLine{90 }
\DoxyCodeLine{96             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a2432ff11db00aad60cdf4aac0a371c3d}{init\_planar\_cell\_fitting}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthCloudArray);}
\DoxyCodeLine{97 }
\DoxyCodeLine{103             uint \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ae722fbe4e5f4c84ce22ba26272a890ea}{init\_histogram}}();}
\DoxyCodeLine{104 }
\DoxyCodeLine{111             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a0b258d0c1f42657ccabc1aceb1cd3e7c}{grow\_planes\_and\_cylinders}}(uint remainingPlanarCells, \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ad96ff3c75c6a7784c3a8f1f4b0102a65}{intpair\_vector}}\& cylinderToRegionMap);}
\DoxyCodeLine{112 }
\DoxyCodeLine{118             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a3ccd5670ed0507cbd74c0fb8cf70e6a2}{merge\_planes}}(\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ab3ed9416eca995f1a3dc2fc2795bb2db}{uint\_vector}}\& planeMergeLabels);}
\DoxyCodeLine{119 }
\DoxyCodeLine{127             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a5e9bdbde2b9ac905322e7b499796edef}{refine\_plane\_boundaries}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthCloudArray, \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ab3ed9416eca995f1a3dc2fc2795bb2db}{uint\_vector}}\& planeMergeLabels, \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1primitives_a82fffe54c97a2ecd30ab76c0b1b1d910}{primitive\_container}}\& primitiveSegments);}
\DoxyCodeLine{128 }
\DoxyCodeLine{136             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ade155c5358bd18f05407c4fd4d0e2183}{refine\_cylinder\_boundaries}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthCloudArray, \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ad96ff3c75c6a7784c3a8f1f4b0102a65}{intpair\_vector}}\& cylinderToRegionMap, \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1primitives_a82fffe54c97a2ecd30ab76c0b1b1d910}{primitive\_container}}\& primitiveSegments); }
\DoxyCodeLine{137 }
\DoxyCodeLine{143             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a43e507867cbf8d34e6931225971911f0}{set\_masked\_display}}(cv::Mat\& segOut); }
\DoxyCodeLine{144 }
\DoxyCodeLine{153             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ac73bd13f1cce9a325b0a26a82efb189d}{region\_growing}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} x, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} y, \textcolor{keyword}{const} \mbox{\hyperlink{namespacergbd__slam_a1c642e1c4dfceaa8c7409331bfc10b6b}{vector3}}\& seedPlaneNormal, \textcolor{keyword}{const} \textcolor{keywordtype}{double} seedPlaneD);}
\DoxyCodeLine{154 }
\DoxyCodeLine{161             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_aa122f54c9de8589811b434d10d0a4268}{get\_connected\_components}}(\textcolor{keyword}{const} cv::Mat\& segmentMap, \mbox{\hyperlink{namespacergbd__slam_a0fe13c1b6f4e20bd00b1d8c76d6fcc53}{Matrixb}}\& planesAssociationMatrix) \textcolor{keyword}{const};}
\DoxyCodeLine{162 }
\DoxyCodeLine{163         \textcolor{keyword}{private}:}
\DoxyCodeLine{164             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_histogram}{Histogram}} \_histogram;}
\DoxyCodeLine{165 }
\DoxyCodeLine{166             \textcolor{keyword}{const} uint \_width;}
\DoxyCodeLine{167             \textcolor{keyword}{const} uint \_height;}
\DoxyCodeLine{168             \textcolor{keyword}{const} uint \_pointsPerCellCount;}
\DoxyCodeLine{169             \textcolor{keyword}{const} \textcolor{keywordtype}{float} \_minCosAngleForMerge;}
\DoxyCodeLine{170             \textcolor{keyword}{const} \textcolor{keywordtype}{float} \_maxMergeDist;}
\DoxyCodeLine{171 }
\DoxyCodeLine{172             \textcolor{keyword}{const} \textcolor{keywordtype}{bool} \_useCylinderDetection;}
\DoxyCodeLine{173 }
\DoxyCodeLine{174             \textcolor{keyword}{const} uint \_cellWidth;}
\DoxyCodeLine{175             \textcolor{keyword}{const} uint \_cellHeight;}
\DoxyCodeLine{176 }
\DoxyCodeLine{177             \textcolor{keyword}{const} uint \_horizontalCellsCount;}
\DoxyCodeLine{178             \textcolor{keyword}{const} uint \_verticalCellsCount;}
\DoxyCodeLine{179             \textcolor{keyword}{const} uint \_totalCellCount;}
\DoxyCodeLine{180 }
\DoxyCodeLine{181             std::vector<plane\_segment\_unique\_ptr> \_planeGrid;}
\DoxyCodeLine{182             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a1c6de1dae1c5b4783520c1720ad1bd7b}{planes\_ptr\_vector}} \_planeSegments;}
\DoxyCodeLine{183             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_ae175d07a6ac399887ee4cd473b76fa41}{cylinders\_ptr\_vector}} \_cylinderSegments;}
\DoxyCodeLine{184 }
\DoxyCodeLine{185             cv::Mat\_<int> \_gridPlaneSegmentMap;}
\DoxyCodeLine{186             cv::Mat\_<uchar> \_gridPlaneSegMapEroded;}
\DoxyCodeLine{187             cv::Mat\_<int> \_gridCylinderSegMap;}
\DoxyCodeLine{188             cv::Mat\_<uchar> \_gridCylinderSegMapEroded;}
\DoxyCodeLine{189 }
\DoxyCodeLine{190             Eigen::ArrayXf \_distancesCellStacked;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192             \textcolor{comment}{//arrays}}
\DoxyCodeLine{193             std::vector<bool> \_activationMap;}
\DoxyCodeLine{194             std::vector<bool> \_unassignedMask;}
\DoxyCodeLine{195             std::vector<float> \_distancesStacked;}
\DoxyCodeLine{196             std::vector<unsigned char> \_segMapStacked;}
\DoxyCodeLine{197             std::vector<float> \_cellDistanceTols;}
\DoxyCodeLine{198 }
\DoxyCodeLine{199             \textcolor{comment}{//mat}}
\DoxyCodeLine{200             cv::Mat \_mask;}
\DoxyCodeLine{201             cv::Mat \_maskEroded;}
\DoxyCodeLine{202             cv::Mat \_maskDilated;}
\DoxyCodeLine{203             cv::Mat \_maskDiff;}
\DoxyCodeLine{204 }
\DoxyCodeLine{205             \textcolor{comment}{//kernels}}
\DoxyCodeLine{206             cv::Mat \_maskSquareKernel;}
\DoxyCodeLine{207             cv::Mat \_maskCrossKernel;}
\DoxyCodeLine{208 }
\DoxyCodeLine{209         \textcolor{keyword}{private}:}
\DoxyCodeLine{210             \textcolor{comment}{//prevent backend copy}}
\DoxyCodeLine{211             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection_a096293d1058519af4111f1841496cccf}{Primitive\_Detection}}(\textcolor{keyword}{const} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection}{Primitive\_Detection}}\&);}
\DoxyCodeLine{212             \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection}{Primitive\_Detection}}\& operator=(\textcolor{keyword}{const} \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_primitive___detection}{Primitive\_Detection}}\&);}
\DoxyCodeLine{213     \};}
\DoxyCodeLine{214 }
\DoxyCodeLine{215 \}}
\DoxyCodeLine{216 \}}
\DoxyCodeLine{217 \}}
\DoxyCodeLine{218 }
\DoxyCodeLine{219 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
