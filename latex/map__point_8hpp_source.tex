\hypertarget{map__point_8hpp_source}{}\doxysection{map\+\_\+point.\+hpp}
\label{map__point_8hpp_source}\index{/home/baptisteh/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/map\_management/map\_point.hpp@{/home/baptisteh/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/map\_management/map\_point.hpp}}
\mbox{\hyperlink{map__point_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ RGBDSLAM\_MAPMANAGEMENT\_MAPPOINT\_HPP}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ RGBDSLAM\_MAPMANAGEMENT\_MAPPOINT\_HPP}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}../features/keypoints/keypoint\_handler.hpp"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}../tracking/kalman\_filter.hpp"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}../utils/coordinates.hpp"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{feature__map_8hpp}{feature\_map.hpp}}"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{matches__containers_8hpp}{matches\_containers.hpp}}"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{parameters_8hpp}{parameters.hpp}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <opencv2/opencv.hpp>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacergbd__slam}{rgbd\_slam}}\ \{}
\DoxyCodeLine{00013\ \textcolor{keyword}{namespace\ }map\_management\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ad715b0460102980c8d6fcaa81b1107d3}{INVALID\_POINT\_UNIQ\_ID}}\ =\ 0;\ \textcolor{comment}{//\ This\ id\ indicates\ an\ invalid\ unique\ id\ for\ a\ map\ point}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point}{Point}}}
\DoxyCodeLine{00018\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{comment}{//\ world\ coordinates}}
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}};}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{comment}{//\ 3D\ descriptor\ (ORB)}}
\DoxyCodeLine{00022\ \ \ \ \ cv::Mat\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}};}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{comment}{//\ position\ covariance}}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}};}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a93f33e8e6e997f3babfe0c104ff95d47}{Point}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\&\ coordinates,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ covariance,\ \textcolor{keyword}{const}\ cv::Mat\&\ descriptor)\ :}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}(coordinates),}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}}(descriptor),}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}}(covariance)}
\DoxyCodeLine{00030\ \ \ \ \ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ build\_kalman\_filter();}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ assert(not\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}}.empty()\ and\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}}.cols\ >\ 0);}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ assert(not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.x())\ and\ not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.y())\ and}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.z()));}
\DoxyCodeLine{00036\ \ \ \ \ \};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a0693e602b92fa0d3b12fb045e8c74580}{track}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\&\ newDetectionCoordinates,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ newDetectionCovariance)}
\DoxyCodeLine{00047\ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ assert(\_kalmanFilter\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::pair<vector3,\ matrix33>\&\ res\ =\ \_kalmanFilter-\/>\mbox{\hyperlink{classrgbd__slam_1_1tracking_1_1_shared_kalman_filter_ac91372f16c707d0af2668c74de28d510}{get\_new\_state}}(}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}},\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}},\ newDetectionCoordinates,\ newDetectionCovariance);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ score\ =\ (\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}\ -\/\ res.first).norm();}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}\ =\ res.first;}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}}\ =\ res.second;}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ assert(not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.x())\ and\ not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.y())\ and}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.z()));}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ score;}
\DoxyCodeLine{00060\ \ \ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ build\_kalman\_filter()}
\DoxyCodeLine{00067\ \ \ \ \ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_kalmanFilter\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ gain\ 10mm\ of\ uncertainty\ at\ each\ iteration}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ pointProcessNoise\ =\ 0;\ \ \ \ \textcolor{comment}{//\ TODO\ set\ in\ parameters}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ stateDimension\ =\ 3;\ \ \ \ \ \ \ \textcolor{comment}{//\ x,\ y,\ z}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ measurementDimension\ =\ 3;\ \textcolor{comment}{//\ x,\ y,\ z}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_ad3944806a3e625773f01e4fd81d3b05b}{matrixd}}\ systemDynamics(stateDimension,\ stateDimension);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ System\ dynamics\ matrix}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_ad3944806a3e625773f01e4fd81d3b05b}{matrixd}}\ outputMatrix(measurementDimension,\ stateDimension);\ \ \ \ \ \textcolor{comment}{//\ Output\ matrix}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_ad3944806a3e625773f01e4fd81d3b05b}{matrixd}}\ processNoiseCovariance(stateDimension,\ stateDimension);\ \textcolor{comment}{//\ Process\ noise\ covariance}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Points\ are\ not\ supposed\ to\ move,\ so\ no\ dynamics}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ systemDynamics.setIdentity();}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ need\ all\ positions}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ outputMatrix.setIdentity();}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ processNoiseCovariance.setIdentity();}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ processNoiseCovariance\ *=\ pointProcessNoise;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \_kalmanFilter\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classrgbd__slam_1_1tracking_1_1_shared_kalman_filter}{tracking::SharedKalmanFilter}}(systemDynamics,\ outputMatrix,\ processNoiseCovariance);}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{comment}{//\ shared\ kalman\ filter,\ between\ all\ points}}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ tracking::SharedKalmanFilter*\ \_kalmanFilter\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00092\ \};}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler}{features::keypoints::Keypoint\_Handler}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_a95c21ce2a6639057adf799fea76af9b1}{DetectedKeypointsObject}};}
\DoxyCodeLine{00095\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point}{features::keypoints::DetectedKeyPoint}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_a2894a3e69da189eb9f8a08cbe55f3da9}{DetectedPointType}};}
\DoxyCodeLine{00096\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structrgbd__slam_1_1matches__containers_1_1_match_template}{matches\_containers::PointMatch}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_a05288063cc8e5137112e03da885de895}{PointMatchType}};}
\DoxyCodeLine{00097\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_keypoints_with_id_struct}{features::keypoints::KeypointsWithIdStruct}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_a1c750ff4cc7dbe8bb4fa3bc6092bdcf3}{TrackedPointsObject}};}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point}{MapPoint}}\ :}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point}{Point}},}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature}{IMapFeature}}<DetectedKeypointsObject,\ DetectedPointType,\ PointMatchType,\ TrackedPointsObject>}
\DoxyCodeLine{00102\ \{}
\DoxyCodeLine{00103\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_a96d952d921e676fb23dc3a283fe2302e}{MapPoint}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\&\ coordinates,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ covariance,\ \textcolor{keyword}{const}\ cv::Mat\&\ descriptor)\ :}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point}{Point}}(coordinates,\ covariance,\ descriptor),}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature}{IMapFeature}}<\mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler}{DetectedKeypointsObject}},\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point}{DetectedPointType}},\ \mbox{\hyperlink{structrgbd__slam_1_1matches__containers_1_1_match_template}{PointMatchType}},\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_keypoints_with_id_struct}{TrackedPointsObject}}>()}
\DoxyCodeLine{00107\ \ \ \ \ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}}\ >\ 0);}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_a80945027399007da7d28dc18ac928d05}{MapPoint}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\&\ coordinates,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ covariance,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ cv::Mat\&\ descriptor,}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \textcolor{keywordtype}{id})\ :}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point}{Point}}(coordinates,\ covariance,\ descriptor),}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature}{IMapFeature}}<\mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler}{DetectedKeypointsObject}},\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point}{DetectedPointType}},\ \mbox{\hyperlink{structrgbd__slam_1_1matches__containers_1_1_match_template}{PointMatchType}},\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_keypoints_with_id_struct}{TrackedPointsObject}}>(id)}
\DoxyCodeLine{00117\ \ \ \ \ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}}\ >\ 0);}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_a6e01727ab96288235a0fae988ccb26eb}{find\_match}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler}{DetectedKeypointsObject}}\&\ detectedFeatures,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamera,}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_ad78c6ab4d4b0133a34dbdd7901ddf7f8}{vectorb}}\&\ isDetectedFeatureMatched,}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::list<PointMatchType>\&\ matches,}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ shouldAddToMatches\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ useAdvancedSearch\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00127\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ searchSpaceRadius\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_a5c3b7fe39a4ae5c7382408126b8f1c7a}{Parameters::get\_search\_matches\_distance}}();}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ advancedSearchSpaceRadius\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_a5c3b7fe39a4ae5c7382408126b8f1c7a}{Parameters::get\_search\_matches\_distance}}()\ *\ 2;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ searchRadius\ =\ useAdvancedSearch\ ?\ advancedSearchSpaceRadius\ :\ searchSpaceRadius;}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ try\ to\ match\ with\ tracking}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ invalidfeatureIndex\ =\ \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1keypoints_a971a9b22938388e8501402da887c4bb1}{features::keypoints::INVALID\_MATCH\_INDEX}};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ matchIndex\ =\ detectedFeatures.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler_a5c91eb5ffe6398f16309667053291720}{get\_tracking\_match\_index}}(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}},\ isDetectedFeatureMatched);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (matchIndex\ ==\ invalidfeatureIndex)}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ match:\ try\ to\ find\ match\ in\ a\ window\ around\ the\ point}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate2_d}{utils::ScreenCoordinate2D}}\ projectedMapPoint;}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ isScreenCoordinatesValid\ =\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate_a8e45201bdaeaf8a7570ec78d4bacf0a8}{to\_screen\_coordinates}}(worldToCamera,\ projectedMapPoint);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isScreenCoordinatesValid)}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ matchIndex\ =\ detectedFeatures.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler_a22b92c6bcad04249ba7ea9b3c3d5cbec}{get\_match\_index}}(}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ projectedMapPoint,\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}},\ isDetectedFeatureMatched,\ searchRadius);}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (matchIndex\ ==\ invalidfeatureIndex)}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ unmatched\ point}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a965a94a5ffa851e7fb3851aa47b9ce09}{UNMATCHED\_FEATURE\_INDEX}};}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ assert(matchIndex\ >=\ 0);}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ assert(\textcolor{keyword}{static\_cast<}Eigen::Index\textcolor{keyword}{>}(matchIndex)\ <\ isDetectedFeatureMatched.size());}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isDetectedFeatureMatched[matchIndex])}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ point\ was\ already\ matched}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_1_1outputs_a7c11e499578358f64a58d71f5b0dfb4d}{outputs::log\_error}}(\textcolor{stringliteral}{"{}The\ requested\ point\ unique\ index\ is\ already\ matched"{}});}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shouldAddToMatches)}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1screen_coordinate_covariance}{rgbd\_slam::screenCoordinateCovariance}}\&\ screenCovariance\ =}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_1_1utils_aede262c3a1f121d6b1cdf563589af35e}{utils::get\_screen\_point\_covariance}}(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}},\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}});}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ consider\ only\ the\ diagonal\ part\ of\ the\ matrix:\ it\ is\ the\ 2D\ variance\ en\ x/y\ in\ screen\ space}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_acbfe158267b4d08e84815de6e0fc4cda}{vector2}}\&\ screenPointCovariance(screenCovariance.diagonal().head(2));}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ matches.emplace\_back(\mbox{\hyperlink{namespacergbd__slam_1_1map__management_a05288063cc8e5137112e03da885de895}{PointMatchType}}(detectedFeatures.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1keypoints_1_1_keypoint___handler_a9633779b8e95af25326b1b7bb89ebe62}{get\_keypoint}}(matchIndex),}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}},}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}}.diagonal(),}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ screenPointCovariance,}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}}));}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matchIndex;}
\DoxyCodeLine{00174\ \ \ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_ac81f11804daec452b06f406563ac8b3d}{add\_to\_tracked}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamera,}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_keypoints_with_id_struct}{TrackedPointsObject}}\&\ trackedFeatures,}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint\ dropChance\ =\ 1000)\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00179\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ shouldNotDropPoint\ =\ (dropChance\ ==\ 0)\ or\ (\mbox{\hyperlink{classrgbd__slam_1_1utils_1_1_random_aa1a557874759dc86cc5b19cc18a32894}{utils::Random::get\_random\_uint}}(dropChance)\ !=\ 0);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ assert(not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.x())\ and\ not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.y())\ and}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ not\ std::isnan(\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.z()));}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shouldNotDropPoint)}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate2_d}{utils::ScreenCoordinate2D}}\ screenCoordinates;}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate_a8e45201bdaeaf8a7570ec78d4bacf0a8}{to\_screen\_coordinates}}(worldToCamera,\ screenCoordinates))}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ use\ previously\ known\ screen\ coordinates}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trackedFeatures.\mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_keypoints_with_id_struct_a6d57bd1cc5fc732b61470fab30221bac}{add}}(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}},\ screenCoordinates.x(),\ screenCoordinates.y());}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ point\ was\ not\ added}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00197\ \ \ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_a957b2d7cbb3a0d56f0ff25eea3a42231}{draw}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamMatrix,}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cv::Mat\&\ debugImage,}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ cv::Scalar\&\ color)\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00202\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate2_d}{utils::ScreenCoordinate2D}}\ screenPoint;}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ isCoordinatesValid\ =\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate_a8e45201bdaeaf8a7570ec78d4bacf0a8}{to\_screen\_coordinates}}(worldToCamMatrix,\ screenPoint);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isCoordinatesValid)}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ cv::circle(debugImage,}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cv::Point(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(screenPoint.x()),\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(screenPoint.y())),}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 3,}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color,}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/1);}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_ad60d4e2cec26feab3229bcd98de4b451}{is\_visible}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamMatrix)\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00217\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ uint\ screenSizeX\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_a4539bf718cf8fc2a8375d1d1fccd810b}{Parameters::get\_camera\_1\_size\_x}}();}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ uint\ screenSizeY\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_af9582d87c9162e3d2d16c365889e3db0}{Parameters::get\_camera\_1\_size\_y}}();}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate}{utils::ScreenCoordinate}}\ projectedScreenCoordinates;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ isProjected\ =\ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate_a8e45201bdaeaf8a7570ec78d4bacf0a8}{to\_screen\_coordinates}}(worldToCamMatrix,\ projectedScreenCoordinates);}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isProjected)}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ in\ screen\ space}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ projectedScreenCoordinates.x()\ >=\ 0\ and\ projectedScreenCoordinates.x()\ <=\ screenSizeX\ and}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ projectedScreenCoordinates.y()\ >=\ 0\ and\ projectedScreenCoordinates.y()\ <=\ screenSizeY\ and}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ in\ front\ of\ the\ camera}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ projectedScreenCoordinates.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate_a022b9f3a22ba5bd47a166c0c4ca204b4}{z}}()\ >=\ 0;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_a8fe1147af7699f63c92d2c038655a9d7}{update\_with\_match}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point}{DetectedPointType}}\&\ matchedFeature,}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ poseCovariance,}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1camera_to_world_matrix}{cameraToWorldMatrix}}\&\ cameraToWorld)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00239\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a2cdcd6ba3138a1fe84346b571479d3de}{\_matchIndex}}\ >=\ 0);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate}{utils::ScreenCoordinate}}\&\ matchedScreenPoint\ =\ matchedFeature.\mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point_a8023fa5ba7a0222bdff0c37968af2a8e}{\_coordinates}};}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacergbd__slam_1_1utils_adba3e96e0d019dbd7284e4a6dc4911f3}{utils::is\_depth\_valid}}(matchedScreenPoint.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate_a022b9f3a22ba5bd47a166c0c4ca204b4}{z}}()))}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ transform\ screen\ point\ to\ world\ point}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\&\ worldPointCoordinates\ =}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ matchedScreenPoint.\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_screen_coordinate_a0f9594f0fb42f01cefa0ef4a3defd80a}{to\_world\_coordinates}}(cameraToWorld);}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ a\ measure\ of\ the\ estimated\ variance\ of\ the\ new\ world\ point}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1camera_coordinate_covariance}{cameraCoordinateCovariance}}\&\ cameraPointCovariance\ =}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_1_1utils_affb3af7de401247c96630ba2e56be652}{utils::get\_camera\_point\_covariance}}(matchedScreenPoint);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ worldCovariance\ =\ poseCovariance\ +\ cameraPointCovariance.base();}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ update\ this\ map\ point\ errors\ \&\ position}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a0693e602b92fa0d3b12fb045e8c74580}{track}}(worldPointCoordinates,\ worldCovariance);}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ a\ new\ descriptor\ is\ available,\ update\ it}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ cv::Mat\&\ descriptor\ =\ matchedFeature.\mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point_a1eb2ad0355ba61e0407ec06afc301d84}{\_descriptor}};}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (not\ descriptor.empty())}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}}\ =\ descriptor;}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Point\ is\ 2D,\ handle\ separatly}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00267\ \ \ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point_a4ab945a43f4e6b20e0e97f1d498f9519}{update\_no\_match}}()\textcolor{keyword}{\ override}}
\DoxyCodeLine{00270\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ nothing}}
\DoxyCodeLine{00272\ \ \ \ \ \}}
\DoxyCodeLine{00273\ \};}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00278\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point}{StagedMapPoint}}\ :\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point}{MapPoint}},\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_staged_map_feature}{IStagedMapFeature}}<DetectedPointType>}
\DoxyCodeLine{00279\ \{}
\DoxyCodeLine{00280\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00281\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point_a58cd2de989b702b323afc10978eb61fd}{StagedMapPoint}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ poseCovariance,}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1camera_to_world_matrix}{cameraToWorldMatrix}}\&\ cameraToWorld,}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1features_1_1keypoints_1_1_detected_key_point}{DetectedPointType}}\&\ detectedFeature)\ :}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point}{MapPoint}}(detectedFeature.\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}}.to\_world\_coordinates(cameraToWorld),}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ utils::get\_camera\_point\_covariance(detectedFeature.\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}})\ +\ poseCovariance,}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ detectedFeature.\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}})}
\DoxyCodeLine{00287\ \ \ \ \ \{}
\DoxyCodeLine{00288\ \ \ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point_aec24eb411cc06767fa3a2c1a5ed2174e}{should\_remove\_from\_staged}}()\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00291\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point_a5370804e25eed8b1fba2612582bbd97f}{get\_confidence}}()\ <=\ 0;}
\DoxyCodeLine{00293\ \ \ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point_aacc1cf6a8f20c8d754556ca05429aba7}{should\_add\_to\_local\_map}}()\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00296\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ minimumConfidenceForLocalMap\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_a4743d8efa22ba16a704875096d7817a3}{Parameters::get\_minimum\_confidence\_for\_local\_map}}();}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point_a5370804e25eed8b1fba2612582bbd97f}{get\_confidence}}()\ >\ minimumConfidenceForLocalMap);}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point_a5370804e25eed8b1fba2612582bbd97f}{get\_confidence}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00303\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ stagedPointconfidence\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{classrgbd__slam_1_1_parameters_a754162a46c3dda3643df55c6e873d328}{Parameters::get\_point\_staged\_age\_confidence}}());}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ confidence\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a652dc56e42d950f53c4791e71cde7c7f}{\_successivMatchedCount}})\ /\ stagedPointconfidence;}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::clamp(confidence,\ -\/1.0,\ 1.0);}
\DoxyCodeLine{00307\ \ \ \ \ \}}
\DoxyCodeLine{00308\ \};}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00313\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_local_map_point}{LocalMapPoint}}\ :\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point}{MapPoint}},\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_local_map_feature}{ILocalMapFeature}}<StagedMapPoint>}
\DoxyCodeLine{00314\ \{}
\DoxyCodeLine{00315\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00316\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_local_map_point_a43e4e516be1dfd72e0f96538127d5b1e}{LocalMapPoint}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_point}{StagedMapPoint}}\&\ stagedPoint)\ :}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_point}{MapPoint}}(stagedPoint.\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_aa538c84e53a30f94804c77fbfa6dda0c}{\_coordinates}},\ stagedPoint.\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_a8f4fe80c0500949f7eb49e74b21f379e}{\_covariance}},\ stagedPoint.\mbox{\hyperlink{structrgbd__slam_1_1map__management_1_1_point_acb78f641c06c5c7ad59b03bc4cebed47}{\_descriptor}},\ stagedPoint.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}})}
\DoxyCodeLine{00318\ \ \ \ \ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ new\ map\ point,\ new\ color}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_local_map_feature_a213516b7a940144f3033242d830af924}{set\_color}}();}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a2cdcd6ba3138a1fe84346b571479d3de}{\_matchIndex}}\ =\ stagedPoint.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a2cdcd6ba3138a1fe84346b571479d3de}{\_matchIndex}};}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a652dc56e42d950f53c4791e71cde7c7f}{\_successivMatchedCount}}\ =\ stagedPoint.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a652dc56e42d950f53c4791e71cde7c7f}{\_successivMatchedCount}};}
\DoxyCodeLine{00324\ \ \ \ \ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_local_map_point_a9eea3c7b88e2919e739ebf9cce887702}{is\_lost}}()\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00327\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{static}\ uint\ maximumUnmatchBeforeRemoval\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_a3be7111a9c245fdc4330d26da4193b6d}{Parameters::get\_maximum\_unmatched\_before\_removal}}();}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_af1c6ff5c9dd91b5aef2eefd7c85364b3}{\_failedTrackingCount}}\ >\ maximumUnmatchBeforeRemoval);}
\DoxyCodeLine{00330\ \ \ \ \ \}}
\DoxyCodeLine{00331\ \};}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \}\ \textcolor{comment}{//\ namespace\ map\_management}}
\DoxyCodeLine{00334\ \}\ \textcolor{comment}{//\ namespace\ rgbd\_slam}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
