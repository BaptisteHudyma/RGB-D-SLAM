\hypertarget{_primitive_detection_8hpp_source}{}\doxysection{Primitive\+Detection.\+hpp}
\label{_primitive_detection_8hpp_source}\index{/home/baptou/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/primitives\_detection/PrimitiveDetection.hpp@{/home/baptou/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/primitives\_detection/PrimitiveDetection.hpp}}
\mbox{\hyperlink{_primitive_detection_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef PLANE\_DETECTION\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define PLANE\_DETECTION\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <iterator>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <opencv2/opencv.hpp>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_plane_segment_8hpp}{PlaneSegment.hpp}}"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_cylinder_segment_8hpp}{CylinderSegment.hpp}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_histogram_8hpp}{Histogram.hpp}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_shape_primitives_8hpp}{ShapePrimitives.hpp}}"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacergbd__slam}{rgbd\_slam}} \{}
\DoxyCodeLine{21 \textcolor{keyword}{namespace }primitiveDetection \{}
\DoxyCodeLine{22 }
\DoxyCodeLine{26     \textcolor{keyword}{class }\mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection}{Primitive\_Detection}} \{}
\DoxyCodeLine{27         \textcolor{comment}{//check for planes in an organized depth points matrix }}
\DoxyCodeLine{28         \textcolor{keyword}{protected}:}
\DoxyCodeLine{29             \textcolor{comment}{//typdefs}}
\DoxyCodeLine{30             \textcolor{keyword}{typedef} std::vector<std::pair<int, int>> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a81ff6f9c67f4ed97ab98435d28648f82}{intpair\_vector}};}
\DoxyCodeLine{31             \textcolor{keyword}{typedef} std::unique\_ptr<Plane\_Segment> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ae5a451d531a3d7d843677c5cba50f224}{plane\_segment\_unique\_ptr}};}
\DoxyCodeLine{32             \textcolor{keyword}{typedef} std::unique\_ptr<Cylinder\_Segment> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a58217a3b8251b8d7188a93d2ce768b76}{cylinder\_segment\_unique\_ptr}};}
\DoxyCodeLine{33             \textcolor{keyword}{typedef} std::vector<plane\_segment\_unique\_ptr> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a4c5f92bd616fefce1686c0cb90e739ca}{planes\_ptr\_vector}}; }
\DoxyCodeLine{34             \textcolor{keyword}{typedef} std::vector<cylinder\_segment\_unique\_ptr> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a6733820dcc916eb4f09b76495cb12604}{cylinders\_ptr\_vector}}; }
\DoxyCodeLine{35             \textcolor{keyword}{typedef} std::list<std::unique\_ptr<Primitive>> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad9c5cd200e88d8b20e5c9405eb3737af}{primitive\_container}}; }
\DoxyCodeLine{36             \textcolor{keyword}{typedef} std::vector<unsigned int> \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a273cf92ed82f099a68f6ac06a0f6eeda}{uint\_vector}};}
\DoxyCodeLine{37 }
\DoxyCodeLine{38         \textcolor{keyword}{public}:}
\DoxyCodeLine{39 }
\DoxyCodeLine{48             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad01f359b84f36b794c7f94ef9cd9a296}{Primitive\_Detection}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} width, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} height, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} blocSize = 20, \textcolor{keyword}{const} \textcolor{keywordtype}{float} minCosAngeForMerge = 0.9659, \textcolor{keyword}{const} \textcolor{keywordtype}{float} maxMergeDist = 50, \textcolor{keyword}{const} \textcolor{keywordtype}{bool} useCylinderDetection = \textcolor{keyword}{false});}
\DoxyCodeLine{49 }
\DoxyCodeLine{57             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a6b591b9a9ac80a4b79ee3f3199f633a6}{find\_primitives}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthMatrix, \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad9c5cd200e88d8b20e5c9405eb3737af}{primitive\_container}}\& primitiveSegments, cv::Mat\& segOut);  \textcolor{comment}{//detect 3D primitives in depth image}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 }
\DoxyCodeLine{60 }
\DoxyCodeLine{72             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ac140561b17045c60199ac11c0f688480}{apply\_masks}}(\textcolor{keyword}{const} cv::Mat\& inputImage, \textcolor{keyword}{const} std::vector<cv::Vec3b>\& colors, \textcolor{keyword}{const} cv::Mat\& maskImage, \textcolor{keyword}{const} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad9c5cd200e88d8b20e5c9405eb3737af}{primitive\_container}}\& primitiveSegments, cv::Mat\& labeledImage, \textcolor{keyword}{const} std::map<int, int>\& associatedIds, \textcolor{keyword}{const} \textcolor{keywordtype}{double} elapsedTime=0);}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 }
\DoxyCodeLine{75             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a4bfb9f0327a132f81d92f3ca582c6a44}{\string~Primitive\_Detection}}();}
\DoxyCodeLine{76 }
\DoxyCodeLine{77             \textcolor{comment}{//perf measurments}}
\DoxyCodeLine{78             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a63ccbaea58b5a573ce47283a74016da8}{resetTime}};}
\DoxyCodeLine{79             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_aa89d1b70bb67c34e13c56a3b778cf0d3}{initTime}};}
\DoxyCodeLine{80             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ae74ecea4df56631aa2319f8c310e319e}{growTime}};}
\DoxyCodeLine{81             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a30c43444c268ff971d78e0e49265b879}{mergeTime}};}
\DoxyCodeLine{82             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a9fd07f1ff6ec17ecda1f8f42db311af3}{refineTime}};}
\DoxyCodeLine{83             \textcolor{keywordtype}{double} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_acd7b42a409f32a6f3c96931e8f73be65}{setMaskTime}};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85         \textcolor{keyword}{protected}:}
\DoxyCodeLine{86 }
\DoxyCodeLine{90             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a1b6b8bf45a4f87ca1151cbbff81ce230}{reset\_data}}();}
\DoxyCodeLine{91 }
\DoxyCodeLine{97             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a22df7fc49e0d4d966713acb1d04d549a}{init\_planar\_cell\_fitting}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthCloudArray);}
\DoxyCodeLine{98 }
\DoxyCodeLine{104             \textcolor{keywordtype}{int} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a7956a852194bba9082bbaa25c6c41b98}{init\_histogram}}();}
\DoxyCodeLine{105 }
\DoxyCodeLine{112             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ac375b82f02874285713cd905857125bf}{grow\_planes\_and\_cylinders}}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} remainingPlanarCells, \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a81ff6f9c67f4ed97ab98435d28648f82}{intpair\_vector}}\& cylinderToRegionMap);}
\DoxyCodeLine{113 }
\DoxyCodeLine{119             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a55a4e120a2407236954daa4734a2c815}{merge\_planes}}(\mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a273cf92ed82f099a68f6ac06a0f6eeda}{uint\_vector}}\& planeMergeLabels);}
\DoxyCodeLine{120 }
\DoxyCodeLine{128             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a2302fd22c7d10aff0d3a72535734588d}{refine\_plane\_boundaries}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthCloudArray, \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a273cf92ed82f099a68f6ac06a0f6eeda}{uint\_vector}}\& planeMergeLabels, \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad9c5cd200e88d8b20e5c9405eb3737af}{primitive\_container}}\& primitiveSegments);}
\DoxyCodeLine{129 }
\DoxyCodeLine{137             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a71ac302f2adc09ed14ed7aa74983d03a}{refine\_cylinder\_boundaries}}(\textcolor{keyword}{const} Eigen::MatrixXf\& depthCloudArray, \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a81ff6f9c67f4ed97ab98435d28648f82}{intpair\_vector}}\& cylinderToRegionMap, \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad9c5cd200e88d8b20e5c9405eb3737af}{primitive\_container}}\& primitiveSegments); }
\DoxyCodeLine{138 }
\DoxyCodeLine{144             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_afffbdd8c1d5af7b3fe93d21b9cb63c76}{set\_masked\_display}}(cv::Mat\& segOut); }
\DoxyCodeLine{145 }
\DoxyCodeLine{154             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a1ac843e952423d2e8c94db78caada507}{region\_growing}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} x, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} y, \textcolor{keyword}{const} Eigen::Vector3d\& seedPlaneNormal, \textcolor{keyword}{const} \textcolor{keywordtype}{double} seedPlaneD);}
\DoxyCodeLine{155 }
\DoxyCodeLine{162             \textcolor{keywordtype}{void} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a6b18dba918a15c5cce9ea115999d54c6}{get\_connected\_components}}(\textcolor{keyword}{const} cv::Mat\& segmentMap, Eigen::MatrixXd\& planesAssociationMatrix);}
\DoxyCodeLine{163 }
\DoxyCodeLine{164         \textcolor{keyword}{private}:}
\DoxyCodeLine{165             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_histogram}{Histogram}} \_histogram;}
\DoxyCodeLine{166 }
\DoxyCodeLine{167             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_width;}
\DoxyCodeLine{168             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_height;}
\DoxyCodeLine{169             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_blocSize;}
\DoxyCodeLine{170             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_pointsPerCellCount;}
\DoxyCodeLine{171             \textcolor{keyword}{const} \textcolor{keywordtype}{float} \_minCosAngleForMerge;}
\DoxyCodeLine{172             \textcolor{keyword}{const} \textcolor{keywordtype}{float} \_maxMergeDist;}
\DoxyCodeLine{173 }
\DoxyCodeLine{174             \textcolor{keyword}{const} \textcolor{keywordtype}{bool} \_useCylinderDetection;}
\DoxyCodeLine{175 }
\DoxyCodeLine{176             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_cellWidth;}
\DoxyCodeLine{177             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_cellHeight;}
\DoxyCodeLine{178 }
\DoxyCodeLine{179             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_horizontalCellsCount;}
\DoxyCodeLine{180             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_verticalCellsCount;}
\DoxyCodeLine{181             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \_totalCellCount;}
\DoxyCodeLine{182 }
\DoxyCodeLine{183             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ae5a451d531a3d7d843677c5cba50f224}{plane\_segment\_unique\_ptr}} *\_planeGrid;}
\DoxyCodeLine{184             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a4c5f92bd616fefce1686c0cb90e739ca}{planes\_ptr\_vector}} \_planeSegments;}
\DoxyCodeLine{185             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_a6733820dcc916eb4f09b76495cb12604}{cylinders\_ptr\_vector}} \_cylinderSegments;}
\DoxyCodeLine{186 }
\DoxyCodeLine{187             cv::Mat\_<int> \_gridPlaneSegmentMap;}
\DoxyCodeLine{188             cv::Mat\_<uchar> \_gridPlaneSegMapEroded;}
\DoxyCodeLine{189             cv::Mat\_<int> \_gridCylinderSegMap;}
\DoxyCodeLine{190             cv::Mat\_<uchar> \_gridCylinderSegMapEroded;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192             Eigen::ArrayXf \_distancesCellStacked;}
\DoxyCodeLine{193 }
\DoxyCodeLine{194             \textcolor{comment}{//arrays}}
\DoxyCodeLine{195             \textcolor{keywordtype}{bool}* \_activationMap;}
\DoxyCodeLine{196             \textcolor{keywordtype}{bool}* \_unassignedMask;}
\DoxyCodeLine{197             \textcolor{keywordtype}{float}* \_distancesStacked;}
\DoxyCodeLine{198             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* \_segMapStacked;}
\DoxyCodeLine{199             \textcolor{keywordtype}{float}* \_cellDistanceTols;}
\DoxyCodeLine{200 }
\DoxyCodeLine{201             \textcolor{comment}{//mat}}
\DoxyCodeLine{202             cv::Mat \_mask;}
\DoxyCodeLine{203             cv::Mat \_maskEroded;}
\DoxyCodeLine{204             cv::Mat \_maskDilated;}
\DoxyCodeLine{205             cv::Mat \_maskDiff;}
\DoxyCodeLine{206 }
\DoxyCodeLine{207             \textcolor{comment}{//kernels}}
\DoxyCodeLine{208             cv::Mat \_maskSquareKernel;}
\DoxyCodeLine{209             cv::Mat \_maskCrossKernel;}
\DoxyCodeLine{210 }
\DoxyCodeLine{211         \textcolor{keyword}{private}:}
\DoxyCodeLine{212             \textcolor{comment}{//prevent backend copy}}
\DoxyCodeLine{213             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection_ad01f359b84f36b794c7f94ef9cd9a296}{Primitive\_Detection}}(\textcolor{keyword}{const} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection}{Primitive\_Detection}}\&);}
\DoxyCodeLine{214             \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection}{Primitive\_Detection}}\& operator=(\textcolor{keyword}{const} \mbox{\hyperlink{classrgbd__slam_1_1primitive_detection_1_1_primitive___detection}{Primitive\_Detection}}\&);}
\DoxyCodeLine{215     \};}
\DoxyCodeLine{216 }
\DoxyCodeLine{217 \}}
\DoxyCodeLine{218 \}}
\DoxyCodeLine{219 }
\DoxyCodeLine{220 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
