\hypertarget{map__primitive_8hpp_source}{}\doxysection{map\+\_\+primitive.\+hpp}
\label{map__primitive_8hpp_source}\index{/home/baptisteh/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/map\_management/map\_primitive.hpp@{/home/baptisteh/Documents/code/robots/RGB\_SLAM/RGB-\/D-\/SLAM/src/map\_management/map\_primitive.hpp}}
\mbox{\hyperlink{map__primitive_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ RGBDSLAM\_MAPMANAGEMENT\_MAPRIMITIVE\_HPP}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ RGBDSLAM\_MAPMANAGEMENT\_MAPRIMITIVE\_HPP}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}../features/primitives/shape\_primitives.hpp"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}../parameters.hpp"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}../tracking/kalman\_filter.hpp"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../utils/camera\_transformation.hpp"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../utils/coordinates.hpp"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../utils/matches\_containers.hpp"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}../utils/random.hpp"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{feature__map_8hpp}{feature\_map.hpp}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <opencv2/highgui.hpp>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <opencv2/opencv.hpp>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacergbd__slam}{rgbd\_slam}}\ \{}
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }map\_management\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{features::primitives::Plane}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_aacb253b3ad5f6c5efbbe7bab588e03df}{DetectedPlaneType}};}
\DoxyCodeLine{00019\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{namespacergbd__slam_1_1features_1_1primitives_ac85a148cd872917385ff3d0622c8162d}{features::primitives::plane\_container}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ae81589b5d45d36b6a81b595c1d750d05}{DetectedPlaneObject}};}
\DoxyCodeLine{00020\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structrgbd__slam_1_1matches__containers_1_1_match_template}{matches\_containers::PlaneMatch}}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_a2a6b855421340e137ed5f3534ad8d7fc}{PlaneMatchType}};}
\DoxyCodeLine{00021\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ad040cfd44b25854570bb2d067c07b639}{TrackedPlaneObject}};\ \textcolor{comment}{//\ TODO\ implement}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane}{Plane}}}
\DoxyCodeLine{00024\ \{}
\DoxyCodeLine{00025\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_ac45ff8a02b6c0158d345d7adb69ab632}{Plane}}()}
\DoxyCodeLine{00027\ \ \ \ \ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}.setZero();}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}}.setIdentity();}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_acca9e48254d94129725663edd89b01c3}{\_centroid}}.setZero();}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ build\_kalman\_filter();}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ \ \ \ \ uint\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a440c916b429222c2c9243297c6444335}{get\_contained\_pixels}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00039\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{static}\ uint\ cellSize\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_af5b2cfcab2433260bd54fade79f5274c}{Parameters::get\_depth\_map\_patch\_size}}();}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{static}\ uint\ pixelPerCell\ =\ cellSize\ *\ cellSize;}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cv::countNonZero(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_af8b8c8fd4a2cf4afdfc15a4f6f70c145}{\_shapeMask}})\ *\ pixelPerCell;}
\DoxyCodeLine{00043\ \ \ \ \ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_world_coordinates}{utils::PlaneWorldCoordinates}}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a9fac516dde68975943ee4df501c28509}{get\_parametrization}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}};\ \}}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_afcbbe76631ca015792ff00a6dac2c243}{get\_centroid}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_acca9e48254d94129725663edd89b01c3}{\_centroid}};\ \}}
\DoxyCodeLine{00047\ \ \ \ \ cv::Mat\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a54d37981f7e5570f73cec64c4e4c9d16}{get\_mask}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_af8b8c8fd4a2cf4afdfc15a4f6f70c145}{\_shapeMask}};\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a751c86ba4f796c634d0b28328d429d36}{track}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_world_coordinates}{utils::PlaneWorldCoordinates}}\&\ newDetectionParameters,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a4c5100025d8dbfb05b957c61197cc83a}{matrix44}}\&\ newDetectionCovariance,}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\&\ detectedCentroid)}
\DoxyCodeLine{00059\ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ assert(\_kalmanFilter\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::pair<vector4,\ matrix44>\&\ res\ =\ \_kalmanFilter-\/>\mbox{\hyperlink{classrgbd__slam_1_1tracking_1_1_shared_kalman_filter_ac91372f16c707d0af2668c74de28d510}{get\_new\_state}}(}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}},\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}},\ newDetectionParameters,\ newDetectionCovariance);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a5cbcd8eb5bdfc3609954483b8c18b675}{vector4}}\&\ newEstimatedParameters\ =\ res.first;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a4c5100025d8dbfb05b957c61197cc83a}{matrix44}}\&\ newEstimatedCovariance\ =\ res.second;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ score\ =\ (\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}\ -\/\ res.first).norm();}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ source:\ Revisiting\ Uncertainty\ Analysis\ for\ Optimum\ Planes\ Extracted\ from\ 3D\ Range\ Sensor\ Point-\/Clouds}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ covariance\ update}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ Eigen::SelfAdjointEigenSolver<matrix44>\ covarianceSolver(newEstimatedCovariance);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ smallestEigenValue\ =\ covarianceSolver.eigenvalues()(0);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a5cbcd8eb5bdfc3609954483b8c18b675}{vector4}}\&\ smallestEigenVector\ =\ covarianceSolver.eigenvectors().col(0).normalized();}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}}\ =}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newEstimatedCovariance\ -\/\ smallestEigenValue\ *\ smallestEigenVector\ *\ smallestEigenVector.transpose();}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ parameters\ update}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_a5cbcd8eb5bdfc3609954483b8c18b675}{vector4}}\ renormalizedVector\ =\ newEstimatedParameters\ /\ sqrt(pow(newEstimatedParameters.head(3).norm(),\ 2.0)\ +}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pow(newEstimatedParameters(3),\ 2.0));}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ renormalizedVector\ /=\ sqrt(1.0\ -\/\ pow(renormalizedVector(3),\ 2.0));}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}\ <<\ renormalizedVector.head(3).normalized(),\ renormalizedVector(3);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ update\ centroid}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_acca9e48254d94129725663edd89b01c3}{\_centroid}}\ =\ detectedCentroid;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ static\ sanity\ checks}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}}.diagonal()(0)\ >=\ 0\ and\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}}.diagonal()(1)\ >=\ 0\ and\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}}.diagonal()(2)\ >=\ 0\ and}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}}.diagonal()(3)\ >=\ 0);}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ assert(not\ std::isnan(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}.x())\ and\ not\ std::isnan(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}.y())\ and}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ not\ std::isnan(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}.z())\ and\ not\ std::isnan(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}.w()));}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ score;}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_world_coordinates}{utils::PlaneWorldCoordinates}}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}};\ \textcolor{comment}{//\ parametrization\ of\ this\ plane\ in\ world\ space}}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_a4c5100025d8dbfb05b957c61197cc83a}{matrix44}}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_aa924b98843c55cbe3a9907d3b78feaf3}{\_covariance}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ covariance\ of\ this\ plane\ in\ world\ space}}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate}{utils::WorldCoordinate}}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_acca9e48254d94129725663edd89b01c3}{\_centroid}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ centroid\ of\ the\ detected\ plane}}
\DoxyCodeLine{00099\ \ \ \ \ cv::Mat\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_af8b8c8fd4a2cf4afdfc15a4f6f70c145}{\_shapeMask}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ mask\ of\ the\ detected\ plane}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ build\_kalman\_filter()}
\DoxyCodeLine{00106\ \ \ \ \ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_kalmanFilter\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ parametersProcessNoise\ =\ 0;\ \textcolor{comment}{//\ TODO\ set\ in\ parameters}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ stateDimension\ =\ 4;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nx,\ ny,\ nz,\ d}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ measurementDimension\ =\ 4;\ \ \ \textcolor{comment}{//\ nx,\ ny,\ nz,\ d}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_ad3944806a3e625773f01e4fd81d3b05b}{matrixd}}\ systemDynamics(stateDimension,\ stateDimension);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ System\ dynamics\ matrix}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_ad3944806a3e625773f01e4fd81d3b05b}{matrixd}}\ outputMatrix(measurementDimension,\ stateDimension);\ \ \ \ \ \textcolor{comment}{//\ Output\ matrix}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_ad3944806a3e625773f01e4fd81d3b05b}{matrixd}}\ processNoiseCovariance(stateDimension,\ stateDimension);\ \textcolor{comment}{//\ Process\ noise\ covariance}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Points\ are\ not\ supposed\ to\ move,\ so\ no\ dynamics}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ systemDynamics.setIdentity();}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ need\ all\ positions}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ outputMatrix.setIdentity();}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ processNoiseCovariance.setIdentity();}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ processNoiseCovariance\ *=\ parametersProcessNoise;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \_kalmanFilter\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classrgbd__slam_1_1tracking_1_1_shared_kalman_filter}{tracking::SharedKalmanFilter}}(systemDynamics,\ outputMatrix,\ processNoiseCovariance);}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ shared\ kalman\ filter,\ between\ all\ planes}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{classrgbd__slam_1_1tracking_1_1_shared_kalman_filter}{tracking::SharedKalmanFilter}}*\ \_kalmanFilter\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00130\ \};}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane}{MapPlane}}\ :}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane}{Plane}},}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature}{IMapFeature}}<DetectedPlaneObject,\ DetectedPlaneType,\ PlaneMatchType,\ TrackedPlaneObject>}
\DoxyCodeLine{00135\ \{}
\DoxyCodeLine{00136\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_ad567f0b086924d9411d2ab4e17f05123}{MapPlane}}()\ :\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature}{IMapFeature}}<\mbox{\hyperlink{namespacergbd__slam_1_1map__management_ae81589b5d45d36b6a81b595c1d750d05}{DetectedPlaneObject}},\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{DetectedPlaneType}},\ \mbox{\hyperlink{structrgbd__slam_1_1matches__containers_1_1_match_template}{PlaneMatchType}},\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ad040cfd44b25854570bb2d067c07b639}{TrackedPlaneObject}}>()}
\DoxyCodeLine{00138\ \ \ \ \ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}}\ >\ 0);}
\DoxyCodeLine{00140\ \ \ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_ad85eeb2c411dd8cd60873c95c442e030}{MapPlane}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \textcolor{keywordtype}{id})\ :}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature}{IMapFeature}}<\mbox{\hyperlink{namespacergbd__slam_1_1map__management_ae81589b5d45d36b6a81b595c1d750d05}{DetectedPlaneObject}},\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{DetectedPlaneType}},\ \mbox{\hyperlink{structrgbd__slam_1_1matches__containers_1_1_match_template}{PlaneMatchType}},\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ad040cfd44b25854570bb2d067c07b639}{TrackedPlaneObject}}>(id)}
\DoxyCodeLine{00144\ \ \ \ \ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}}\ >\ 0);}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_a816fac00ba24ce117969fc69f897dd0a}{find\_match}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ae81589b5d45d36b6a81b595c1d750d05}{DetectedPlaneObject}}\&\ detectedFeatures,}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamera,}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_ad78c6ab4d4b0133a34dbdd7901ddf7f8}{vectorb}}\&\ isDetectedFeatureMatched,}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::list<PlaneMatchType>\&\ matches,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ shouldAddToMatches\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ useAdvancedSearch\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00154\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1plane_world_to_camera_matrix}{planeWorldToCameraMatrix}}\&\ planeCameraToWorld\ =\ \mbox{\hyperlink{namespacergbd__slam_1_1utils_ab4ddc88ce4d31a2c11785ee2288ba534}{utils::compute\_plane\_world\_to\_camera\_matrix}}(worldToCamera);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ project\ plane\ in\ camera\ space}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_camera_coordinates}{utils::PlaneCameraCoordinates}}\&\ projectedPlane\ =}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a9fac516dde68975943ee4df501c28509}{get\_parametrization}}().\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_world_coordinates_a8c34c38885d6e4c67183255113de06e2}{to\_camera\_coordinates}}(planeCameraToWorld);}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_camera_coordinate}{utils::CameraCoordinate}}\&\ planeCentroid\ =\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_afcbbe76631ca015792ff00a6dac2c243}{get\_centroid}}().\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_world_coordinate_ab7c086860bc38df84a4b32781514c822}{to\_camera\_coordinates}}(worldToCamera);}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a54f5198175c41ce6f3d69192686b8c28}{vector6}}\&\ descriptor\ =}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ features::primitives::Plane::compute\_descriptor(projectedPlane,\ planeCentroid,\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a440c916b429222c2c9243297c6444335}{get\_contained\_pixels}}());}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ similarityThreshold\ =\ useAdvancedSearch\ ?\ 0.2\ :\ 0.4;}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ smallestSimilarity\ =\ std::numeric\_limits<double>::max();}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ selectedIndex\ =\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a965a94a5ffa851e7fb3851aa47b9ce09}{UNMATCHED\_FEATURE\_INDEX}};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ search\ best\ match\ score}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ detectedPlaneSize\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(detectedFeatures.size());}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ planeIndex\ =\ 0;\ planeIndex\ <\ detectedPlaneSize;\ ++planeIndex)}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isDetectedFeatureMatched[planeIndex])}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Does\ not\ allow\ multiple\ removal\ of\ a\ single\ match}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ change\ this}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ assert(planeIndex\ >=\ 0\ and\ planeIndex\ <\ detectedPlaneSize);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{features::primitives::Plane}}\&\ shapePlane\ =\ detectedFeatures[planeIndex];}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ compute\ a\ similarity\ score}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ descriptorSimilarity\ =\ shapePlane.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane_ae27e87c68f42c421d716be8a67c99085}{get\_similarity}}(descriptor);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (descriptorSimilarity\ <\ smallestSimilarity)}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ selectedIndex\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(planeIndex);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ smallestSimilarity\ =\ descriptorSimilarity;}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (selectedIndex\ ==\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a965a94a5ffa851e7fb3851aa47b9ce09}{UNMATCHED\_FEATURE\_INDEX}}\ or\ smallestSimilarity\ >=\ similarityThreshold)}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a965a94a5ffa851e7fb3851aa47b9ce09}{UNMATCHED\_FEATURE\_INDEX}};}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shouldAddToMatches)}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{features::primitives::Plane}}\&\ shapePlane\ =\ detectedFeatures[selectedIndex];}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ replace\ nullptr\ by\ the\ plane\ covariance\ in\ camera\ space}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ matches.emplace\_back(shapePlane.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane_adf12e912231471386701a11d003479d7}{get\_parametrization}}(),\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a9fac516dde68975943ee4df501c28509}{get\_parametrization}}(),\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr},\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}});}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ selectedIndex;}
\DoxyCodeLine{00199\ \ \ \ \ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_a0e1fec550820521a2e9838b5e43b9bc4}{add\_to\_tracked}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamera,}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_1_1map__management_ad040cfd44b25854570bb2d067c07b639}{TrackedPlaneObject}}\&\ trackedFeatures,}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint\ dropChance\ =\ 1000)\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00204\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ silence\ warning\ for\ unused\ parameters}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ (void)worldToCamera;}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ (void)trackedFeatures;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ (void)dropChance;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_a1ccfa1bd6290b3337594e91c8765b0c8}{draw}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamMatrix,}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cv::Mat\&\ debugImage,}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ cv::Scalar\&\ color)\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00215\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ silence\ unused\ parameter\ warning}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ (void)worldToCamMatrix;}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ assert(not\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a54d37981f7e5570f73cec64c4e4c9d16}{get\_mask}}().empty());}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ maskAlpha\ =\ 0.3;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ cv::Size\&\ debugImageSize\ =\ debugImage.size();}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ cv::Mat\ planeMask,\ planeColorMask;}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resize\ with\ no\ interpolation}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ cv::resize(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a54d37981f7e5570f73cec64c4e4c9d16}{get\_mask}}()\ *\ 255,\ planeMask,\ debugImageSize,\ 0,\ 0,\ cv::INTER\_NEAREST);}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ cv::cvtColor(planeMask,\ planeColorMask,\ cv::COLOR\_GRAY2BGR);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ assert(planeMask.size\ ==\ debugImage.size);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ assert(planeMask.size\ ==\ debugImage.size);}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ assert(planeColorMask.type()\ ==\ debugImage.type());}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ merge\ with\ debug\ image}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ planeColorMask.setTo(color,\ planeMask);}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ cv::Mat\ maskedInput,\ ImaskedInput;}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ masked\ original\ image,\ with\ the\ only\ visible\ part\ being\ the\ plane\ part}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ debugImage.copyTo(maskedInput,\ planeMask);}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ masked\ original\ image,\ with\ the\ only\ visible\ part\ being\ the\ non\ plane\ part}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ debugImage.copyTo(ImaskedInput,\ 255\ -\/\ planeMask);}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ cv::addWeighted(maskedInput,\ (1\ -\/\ maskAlpha),\ planeColorMask,\ maskAlpha,\ 0.0,\ maskedInput);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ debugImage\ =\ maskedInput\ +\ ImaskedInput;}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_add5456bd487e43fa067511f965528e81}{is\_visible}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1world_to_camera_matrix}{worldToCameraMatrix}}\&\ worldToCamMatrix)\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00246\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ (void)worldToCamMatrix;}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00250\ \ \ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_a3d432dda73ab80b5f20d3003ecee5f91}{update\_with\_match}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{DetectedPlaneType}}\&\ matchedFeature,}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ poseCovariance,}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1camera_to_world_matrix}{cameraToWorldMatrix}}\&\ cameraToWorld)\textcolor{keyword}{\ override}}
\DoxyCodeLine{00256\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a2cdcd6ba3138a1fe84346b571479d3de}{\_matchIndex}}\ >=\ 0);}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1plane_camera_to_world_matrix}{planeCameraToWorldMatrix}}\&\ planeCameraToWorld\ =\ \mbox{\hyperlink{namespacergbd__slam_1_1utils_afd84759fb9912b365c73bc392434a849}{utils::compute\_plane\_camera\_to\_world\_matrix}}(cameraToWorld);}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacergbd__slam_a4c5100025d8dbfb05b957c61197cc83a}{matrix44}}\ detectedPlaneCovariance;}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ detectedPlaneCovariance.setIdentity();}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a751c86ba4f796c634d0b28328d429d36}{track}}(matchedFeature.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane_adf12e912231471386701a11d003479d7}{get\_parametrization}}().\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_camera_coordinates_a6ed2daea8a8e27a1e6c51b8020ac7f40}{to\_world\_coordinates}}(planeCameraToWorld),}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ detectedPlaneCovariance,\ \textcolor{comment}{//\ TODO:\ transform\ covariance\ to\ world}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ matchedFeature.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane_ae2e93010d7ae57d066492b162b962d52}{get\_centroid}}().\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_camera_coordinate_a879b77b2a8ebaaa2419bd7625d0ba9c0}{to\_world\_coordinates}}(cameraToWorld));}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_af8b8c8fd4a2cf4afdfc15a4f6f70c145}{\_shapeMask}}\ =\ matchedFeature.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_i_primitive_a71f6a83c970280a5fa178aad54e5d052}{get\_shape\_mask}}();}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00270\ \ \ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane_adaaf892b5cead31e6ccd1122d71cd6f5}{update\_no\_match}}()\textcolor{keyword}{\ override\ }\{\}}
\DoxyCodeLine{00273\ \};}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_plane}{StagedMapPlane}}\ :\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane}{MapPlane}},\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_staged_map_feature}{IStagedMapFeature}}<DetectedPlaneType>}
\DoxyCodeLine{00276\ \{}
\DoxyCodeLine{00277\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_plane_a53bcb15b54d3244bd63720bde9c8e1a9}{StagedMapPlane}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacergbd__slam_a2877fc3a278a20d5132bcd38e12faf69}{matrix33}}\&\ poseCovariance,}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1camera_to_world_matrix}{cameraToWorldMatrix}}\&\ cameraToWorld,}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane}{DetectedPlaneType}}\&\ detectedFeature)\ :}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane}{MapPlane}}()}
\DoxyCodeLine{00282\ \ \ \ \ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ (void)poseCovariance;}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structrgbd__slam_1_1plane_camera_to_world_matrix}{planeCameraToWorldMatrix}}\&\ planeCameraToWorld\ =\ \mbox{\hyperlink{namespacergbd__slam_1_1utils_afd84759fb9912b365c73bc392434a849}{utils::compute\_plane\_camera\_to\_world\_matrix}}(cameraToWorld);}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}\ =\ detectedFeature.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane_adf12e912231471386701a11d003479d7}{get\_parametrization}}().\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_plane_camera_coordinates_a6ed2daea8a8e27a1e6c51b8020ac7f40}{to\_world\_coordinates}}(planeCameraToWorld),}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_acca9e48254d94129725663edd89b01c3}{\_centroid}}\ =\ detectedFeature.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_plane_ae2e93010d7ae57d066492b162b962d52}{get\_centroid}}().\mbox{\hyperlink{structrgbd__slam_1_1utils_1_1_camera_coordinate_a879b77b2a8ebaaa2419bd7625d0ba9c0}{to\_world\_coordinates}}(cameraToWorld),}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_af8b8c8fd4a2cf4afdfc15a4f6f70c145}{\_shapeMask}}\ =\ detectedFeature.\mbox{\hyperlink{classrgbd__slam_1_1features_1_1primitives_1_1_i_primitive_a71f6a83c970280a5fa178aad54e5d052}{get\_shape\_mask}}();}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_plane_ac9a0c5a04f95af6358134c5abf7d9b14}{should\_remove\_from\_staged}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_af1c6ff5c9dd91b5aef2eefd7c85364b3}{\_failedTrackingCount}}\ >=\ 2;\ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_plane_a28b91a13d91dcc96c8b824930a85d536}{should\_add\_to\_local\_map}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a652dc56e42d950f53c4791e71cde7c7f}{\_successivMatchedCount}}\ >=\ 1;\ \}}
\DoxyCodeLine{00294\ \};}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_local_map_plane}{LocalMapPlane}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane}{MapPlane}},\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_local_map_feature}{ILocalMapFeature}}<StagedMapPlane>}
\DoxyCodeLine{00297\ \{}
\DoxyCodeLine{00298\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00299\ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_local_map_plane_a21160232b1d91542eb8d2385e7b3d1d8}{LocalMapPlane}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_staged_map_plane}{StagedMapPlane}}\&\ stagedPlane)\ :\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_map_plane}{MapPlane}}(stagedPlane.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_aa7b6261d017379730064aa6912771f57}{\_id}})}
\DoxyCodeLine{00300\ \ \ \ \ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ new\ map\ point,\ new\ color}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_local_map_feature_a213516b7a940144f3033242d830af924}{set\_color}}();}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a2cdcd6ba3138a1fe84346b571479d3de}{\_matchIndex}}\ =\ stagedPlane.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a2cdcd6ba3138a1fe84346b571479d3de}{\_matchIndex}};}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a652dc56e42d950f53c4791e71cde7c7f}{\_successivMatchedCount}}\ =\ stagedPlane.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_a652dc56e42d950f53c4791e71cde7c7f}{\_successivMatchedCount}};}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_abc89e03e637ab75696af42160790e6dc}{\_parametrization}}\ =\ stagedPlane.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a9fac516dde68975943ee4df501c28509}{get\_parametrization}}();}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_acca9e48254d94129725663edd89b01c3}{\_centroid}}\ =\ stagedPlane.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_afcbbe76631ca015792ff00a6dac2c243}{get\_centroid}}();}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_af8b8c8fd4a2cf4afdfc15a4f6f70c145}{\_shapeMask}}\ =\ stagedPlane.\mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_plane_a54d37981f7e5570f73cec64c4e4c9d16}{get\_mask}}();}
\DoxyCodeLine{00310\ \ \ \ \ \}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_local_map_plane_a51987267e79ad9fd9fe6b122c3f25281}{is\_lost}}()\textcolor{keyword}{\ const\ override}}
\DoxyCodeLine{00313\ \textcolor{keyword}{\ \ \ \ }\{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ maximumUnmatchBeforeremoval\ =\ \mbox{\hyperlink{classrgbd__slam_1_1_parameters_a3be7111a9c245fdc4330d26da4193b6d}{Parameters::get\_maximum\_unmatched\_before\_removal}}();}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrgbd__slam_1_1map__management_1_1_i_map_feature_af1c6ff5c9dd91b5aef2eefd7c85364b3}{\_failedTrackingCount}}\ >=\ maximumUnmatchBeforeremoval;}
\DoxyCodeLine{00316\ \ \ \ \ \}}
\DoxyCodeLine{00317\ \};}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \}\ \textcolor{comment}{//\ namespace\ map\_management}}
\DoxyCodeLine{00320\ \}\ \textcolor{comment}{//\ namespace\ rgbd\_slam}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
